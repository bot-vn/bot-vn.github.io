<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #1a1a1a; /* Background color of the page, can be changed */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            display: inline-block;
            text-align: center;
            background-color: white; /* Background color of the container, can be changed */
            padding: 20px;
            border: 4px solid #000000; /* Border color changed to black, can be changed */
            border-radius: 12px;
            width: 300px; /* Fixed width to ensure centering */
        }
        .username {
            color: #0056b3; /* Color of username (blue), can be changed */
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
        }
        .box-info {
            font-size: 16px;
            margin: 12px 0;
            color: #000; /* Color of box info (black), can be changed */
        }
        .flag {
            margin: 0 5px;
        }
        .timer-grid {
            margin: 16px 0;
        }
        .countdown-ms {
            font-size: 60px;
            font-weight: bold;
            color: #000; /* Color of countdown milliseconds (black), changes to #800020 when < 3s, can be changed */
            margin: 0;
            transition: color 0.3s; /* Smooth color transition */
        }
        .countdown-full {
            font-size: 24px; /* Increased for better visibility */
            margin-bottom: 8px;
            color: #000; /* Color of countdown full (black), can be changed */
        }
        button {
            background-color: #007BFF; /* Background color of button (blue), can be changed */
            color: white; /* Text color of button (white), can be changed */
            padding: 10px 20px;
            border: none;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        button:hover {
            background-color: #0056b3; /* Hover color of button (darker blue), can be changed */
        }
        button.disabled {
            background-color: #cccccc; /* Color when disabled (gray), can be changed */
            cursor: not-allowed;
        }
        button.red-text {
            color: #ff0000; /* Color when text is red (e.g., "R∆∞∆°ng n√†y ƒë√£ ƒë∆∞·ª£c m·ªü"), can be changed */
        }
        @keyframes flash {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="username" id="username">@kavooneska2</h2>
        <div class="box-info" id="boxinfo">üéÅ BOX: <span id="coins">50</span>/<span id="viewerRewardCount">50</span> <span class="flag" id="flag">üáßüáæ</span> üëÄ <span id="viewers">56</span></div>
        <div class="timer-grid">
            <div class="countdown-ms" id="countdownMs">49:43</div>
            <div class="countdown-full" id="countdownFull">00:00:49</div> <!-- Can be removed if not needed -->
        </div>
        <button id="actionButton" onclick="openTikTokLive()">Canh gi·ªù ho√†ng ƒë·∫°o</button>
    </div>
    <script>
        // H√†m l·∫•y tham s·ªë t·ª´ URL
        function getParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // H√†m gi·∫£i m√£ base62
        const BASE62_CHARS = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
        function base62Decode(encoded) {
            let num = BigInt(0);
            for (const char of encoded) {
                num = num * BigInt(62) + BigInt(BASE62_CHARS.indexOf(char));
            }
            let result = '';
            while (num > 0) {
                const byte = Number(num % BigInt(256));
                result = String.fromCharCode(byte) + result;
                num = num / BigInt(256);
            }
            return result;
        }

        // H√†m l·∫•y c·ªù qu·ªëc gia
        function getFlag(code) {
            if (!code || code.length !== 2) return 'üè≥Ô∏è';
            const codePoints = [...code.toUpperCase()].map(c => 0x1F1E6 + c.charCodeAt(0) - 65);
            return String.fromCodePoint(...codePoints);
        }

        // H√†m m·ªü TikTok Live
        async function openTikTokLive() {
            try {
                const username = document.getElementById('username').innerText.slice(1);
                const userAgent = navigator.userAgent.toLowerCase();
                const isIOS = /iphone|ipad|ipod/.test(userAgent);
                const isAndroid = /android/.test(userAgent);
                const webUrl = `https://www.tiktok.com/@${username}/live`;
                if (isIOS) document.location.href = `snssdk1180://live?username=${username}`;
                else if (isAndroid) document.location.href = `tiktok://live?username=${username}`;
                else window.location.href = webUrl;
                setTimeout(() => {
                    if (document.hidden || document.visibilityState === 'hidden') {
                        window.close();
                    } else {
                        window.location.href = webUrl;
                    }
                }, 1000);
            } catch (e) {
                alert('Kh√¥ng th·ªÉ m·ªü TikTok Live. Vui l√≤ng th·ª≠ l·∫°i!');
            }
        }

        // Gi·∫£i m√£ v√† c·∫≠p nh·∫≠t giao di·ªán
        const encodedData = getParam('data');
        let params = {};
        if (encodedData) {
            const decodedData = base62Decode(encodedData);
            params = JSON.parse(decodedData);
        } else {
            params = {
                user: 'kavooneska2',
                box: 50,
                divide: 50,
                viewers: 56,
                country: 'BY',
                end: Date.now() + 49430, // 49 gi√¢y 43 mili gi√¢y t·ª´ b√¢y gi·ªù
                createAt: Date.now().toString()
            };
        }

        const username = params.user;
        const coins = parseInt(params.box, 10);
        const viewerRewardCount = parseInt(params.divide, 10);
        const viewers = parseInt(params.viewers, 10);
        const countryCode = params.country;
        const endTime = parseInt(params.end, 10);
        const createAt = params.createAt;

        document.getElementById('username').innerText = `@${username}`;
        document.getElementById('coins').innerText = coins;
        document.getElementById('viewerRewardCount').innerText = viewerRewardCount;
        document.getElementById('viewers').innerText = viewers; // Can be removed if not needed
        document.getElementById('flag').innerText = getFlag(countryCode);

        // C·∫≠p nh·∫≠t th·ªùi gian ƒë·∫øm ng∆∞·ª£c
        let lastUpdate = 0;
        const actionButton = document.getElementById('actionButton');
        function updateTimer(timestamp) {
            if (!lastUpdate || (timestamp - lastUpdate >= 16)) {
                const now = Date.now();
                const remainingMs = Math.max(0, endTime - now);
                const totalSeconds = Math.floor(remainingMs / 1000);
                const ms = Math.floor((remainingMs % 1000) / 10); // 2 ch·ªØ s·ªë mili gi√¢y
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;

                // C·∫≠p nh·∫≠t h√†ng tr√™n (gi√¢y:mili gi√¢y)
                const countdownMsElement = document.getElementById('countdownMs');
                if (remainingMs > 0) {
                    countdownMsElement.innerText = `${seconds.toString().padStart(2, '0')}:${ms.toString().padStart(2, '0')}`;
                    // Chuy·ªÉn sang m√†u ƒë·ªè ƒë·∫≠m (#800020) khi c√≤n d∆∞·ªõi 3 gi√¢y
                    if (remainingMs / 1000 <= 3) {
                        countdownMsElement.style.color = '#800020'; // M√†u m·∫≠n ch√≠n
                    } else {
                        countdownMsElement.style.color = '#000'; // M√†u ƒëen m·∫∑c ƒë·ªãnh
                    }
                }

                // C·∫≠p nh·∫≠t h√†ng d∆∞·ªõi (gi·ªù:ph√∫t:gi√¢y)
                const countdownFullElement = document.getElementById('countdownFull');
                if (remainingMs > 0) {
                    countdownFullElement.innerText = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }

                // Ki·ªÉm tra r∆∞∆°ng ƒë√£ m·ªü
                if (remainingMs <= 0 || now > endTime) {
                    countdownMsElement.innerText = '00:00';
                    countdownFullElement.innerText = '00:00:00';
                    actionButton.innerText = 'R∆∞∆°ng n√†y ƒë√£ ƒë∆∞·ª£c m·ªü';
                    actionButton.classList.add('disabled');
                    actionButton.classList.add('red-text'); // Th√™m class red-text ƒë·ªÉ ƒë·ªïi m√†u ch·ªØ th√†nh ƒë·ªè
                    actionButton.disabled = true; // V√¥ hi·ªáu h√≥a n√∫t
                    return; // D·ª´ng c·∫≠p nh·∫≠t sau khi h·∫øt th·ªùi gian
                }
                lastUpdate = timestamp;
            }
            requestAnimationFrame(updateTimer);
        }
        requestAnimationFrame(updateTimer);
    </script>
</body>
</html>
