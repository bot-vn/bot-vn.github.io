<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Box Countdown</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    .info {
      text-align: center;
      margin-bottom: 20px;
    }
    .info h2 {
      margin: 0;
      font-size: 28px;
      color: #0056b3; /* M√†u xanh d∆∞∆°ng ƒë·∫≠m */
    }
    .info p {
      margin: 4px 0;
      font-size: 18px;
      color: #666;
    }
    .timer {
      font-size: 80px;
      font-weight: bold;
      color: #000;
    }
    .timestamp {
      margin-top: 5px;
      font-size: 18px;
      color: #444;
    }
    .flag {
      font-size: 20px;
    }
  </style>
</head>
<body>
  <div class="info">
    <h2 id="username">@username</h2>
    <p id="boxinfo">üéÅ ?/? <span class="flag">üè≥Ô∏è</span> üëÄ ?</p>
  </div>

  <div class="timer" id="countdown">00:00</div>
  <div class="timestamp" id="dropTime">--:--:--</div>

  <script>
    function getParam(name) {
      return new URLSearchParams(window.location.search).get(name);
    }

    function getFlag(countryCode) {
      if (!countryCode || countryCode.length !== 2) return "üè≥Ô∏è";
      const codePoints = [...countryCode.toUpperCase()].map(c => 0x1F1E6 + c.charCodeAt(0) - 65);
      return String.fromCodePoint(...codePoints);
    }

    // L·∫•y tham s·ªë t·ª´ URL
    const username = getParam("user");
    const box = parseInt(getParam("box"), 10);
    const divide = parseInt(getParam("divide"), 10);
    const viewers = parseInt(getParam("viewers"), 10);
    const countryCode = getParam("country");
    const end = parseInt(getParam("end"), 10); // Th·ªùi gian k·∫øt th√∫c (ms)

    // Ki·ªÉm tra d·ªØ li·ªáu ƒë·∫ßu v√†o
    if (!username || isNaN(box) || isNaN(divide) || isNaN(viewers) || isNaN(end)) {
      const usernameElem = document.getElementById("username");
      usernameElem.innerText = "L·ªói d·ªØ li·ªáu";
      usernameElem.style.color = "#0056b3";
    } else {
      // Hi·ªÉn th·ªã th√¥ng tin
      document.getElementById("username").innerText = `@${username}`;
      document.getElementById("boxinfo").innerHTML = `üéÅ ${box}/${divide} <span class="flag">${getFlag(countryCode)}</span> üëÄ ${viewers}`;

      // T√≠nh th·ªùi gian b·∫Øt ƒë·∫ßu (end - duration)
      const duration = Math.floor((end - Date.now()) / 1000); // Th·ªùi gian c√≤n l·∫°i t·∫°i th·ªùi ƒëi·ªÉm t·∫£i trang
      const start = end - duration * 1000;
      const dropTime = new Date(start);
      document.getElementById("dropTime").innerText = `${dropTime.toLocaleTimeString('vi-VN')}`;

      // C·∫≠p nh·∫≠t ƒë·ªìng h·ªì ƒë·∫øm ng∆∞·ª£c
      function updateTimer() {
        const now = Date.now();
        const remaining = Math.max(0, Math.floor((end - now) / 1000));
        const m = Math.floor(remaining / 60);
        const s = remaining % 60;
        document.getElementById("countdown").innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        if (remaining > 0) setTimeout(updateTimer, 1000);
      }

      updateTimer();
    }
  </script>
</body>
</html>
