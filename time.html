<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #1a1a1a; /* Background color of the page, can be changed */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            display: inline-block;
            text-align: center;
            background-color: white; /* Background color of the container, can be changed */
            padding: 20px;
            border: 4px solid #ff0000; /* Border color (red), can be changed */
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Shadow effect, can be removed */
            width: 300px;
        }
        .username {
            color: #0056b3; /* Color of username (blue), can be changed */
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
        }
        .box-info {
            font-size: 16px;
            margin: 12px 0;
            color: #000; /* Color of box info (black), can be changed */
        }
        .flag {
            margin: 0 5px;
        }
        .timer-grid {
            margin: 16px 0;
        }
        .countdown-ms {
            font-size: 60px;
            font-weight: bold;
            color: #000; /* Color of countdown milliseconds (black), changes to #800020 when < 3s, can be changed */
            margin: 0;
            transition: color 0.3s; /* Smooth color transition */
        }
        .countdown-full {
            font-size: 24px; /* Increased for better visibility */
            margin-bottom: 8px;
            color: #000; /* Color of countdown full (black), can be changed */
        }
        button {
            background-color: #007BFF; /* Background color of button (blue), can be changed */
            color: white; /* Text color of button (white), can be changed */
            padding: 10px 20px;
            border: none;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        button:hover {
            background-color: #0056b3; /* Hover color of button (darker blue), can be changed */
        }
        @keyframes flash {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="username" id="username">@kavooneska2</h2>
        <div class="box-info" id="boxinfo">üéÅ BOX: <span id="coins">50</span>/<span id="viewerRewardCount">50</span> <span class="flag" id="flag">üáßüáæ</span> üëÄ <span id="viewers">56</span></div>
        <div class="timer-grid">
            <div class="countdown-ms" id="countdownMs">49:43</div>
            <div class="countdown-full" id="countdownFull">00:00:49</div> <!-- Can be removed if not needed -->
        </div>
        <button onclick="openTikTokLive()">M·ªü TikTok Live</button>
    </div>
    <script>
        // H√†m l·∫•y tham s·ªë t·ª´ URL
        function getParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // H√†m l·∫•y c·ªù qu·ªëc gia
        function getFlag(code) {
            if (!code || code.length !== 2) return 'üè≥Ô∏è';
            const codePoints = [...code.toUpperCase()].map(c => 0x1F1E6 + c.charCodeAt(0) - 65);
            return String.fromCodePoint(...codePoints);
        }

        // H√†m m·ªü TikTok Live
        async function openTikTokLive() {
            try {
                const username = document.getElementById('username').innerText.slice(1);
                const userAgent = navigator.userAgent.toLowerCase();
                const isIOS = /iphone|ipad|ipod/.test(userAgent);
                const isAndroid = /android/.test(userAgent);
                const webUrl = `https://www.tiktok.com/@${username}/live`;
                if (isIOS) document.location.href = `snssdk1180://live?username=${username}`;
                else if (isAndroid) document.location.href = `tiktok://live?username=${username}`;
                else window.location.href = webUrl;
                setTimeout(() => {
                    if (document.hidden || document.visibilityState === 'hidden') {
                        window.close();
                    } else {
                        window.location.href = webUrl;
                    }
                }, 1000);
            } catch (e) {
                alert('Kh√¥ng th·ªÉ m·ªü TikTok Live. Vui l√≤ng th·ª≠ l·∫°i!');
            }
        }

        // Kh·ªüi t·∫°o d·ªØ li·ªáu
        const username = getParam('user') || 'kavooneska2';
        const coins = parseInt(getParam('box') || '50', 10);
        const viewerRewardCount = parseInt(getParam('divide') || '50', 10);
        const viewers = parseInt(getParam('viewers') || '56', 10);
        const countryCode = getParam('country') || 'BY';
        const initialCountdownMs = parseInt(getParam('initialCountdownMs') || 49430, 10); // 49 gi√¢y 43 mili gi√¢y (49430 ms) based on image

        // C·∫≠p nh·∫≠t giao di·ªán
        document.getElementById('username').innerText = `@${username}`;
        document.getElementById('coins').innerText = coins;
        document.getElementById('viewerRewardCount').innerText = viewerRewardCount;
        document.getElementById('viewers').innerText = viewers; // Can be removed if not needed
        document.getElementById('flag').innerText = getFlag(countryCode);

        // C·∫≠p nh·∫≠t th·ªùi gian ƒë·∫øm ng∆∞·ª£c
        let lastUpdate = 0;
        const startTime = Date.now();
        const endTime = startTime + initialCountdownMs; // K·∫øt th√∫c sau 49 gi√¢y 43 mili gi√¢y t·ª´ l√∫c ch·∫°y

        function updateTimer(timestamp) {
            if (!lastUpdate || (timestamp - lastUpdate >= 16)) {
                const now = Date.now();
                const remainingMs = Math.max(0, endTime - now);
                const totalSeconds = Math.floor(remainingMs / 1000);
                const ms = Math.floor((remainingMs % 1000) / 10); // 2 ch·ªØ s·ªë mili gi√¢y
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;

                // C·∫≠p nh·∫≠t h√†ng tr√™n (gi√¢y:mili gi√¢y)
                const countdownMsElement = document.getElementById('countdownMs');
                countdownMsElement.innerText = `${seconds.toString().padStart(2, '0')}:${ms.toString().padStart(2, '0')}`;
                // Chuy·ªÉn sang m√†u ƒë·ªè ƒë·∫≠m (#800020) khi c√≤n d∆∞·ªõi 3 gi√¢y
                if (remainingMs / 1000 <= 3) {
                    countdownMsElement.style.color = '#800020'; // M√†u m·∫≠n ch√≠n
                } else {
                    countdownMsElement.style.color = '#000'; // M√†u ƒëen m·∫∑c ƒë·ªãnh
                }

                // C·∫≠p nh·∫≠t h√†ng d∆∞·ªõi (gi·ªù:ph√∫t:gi√¢y)
                document.getElementById('countdownFull').innerText = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`; // Can be removed if not needed

                if (remainingMs <= 0) {
                    countdownMsElement.innerText = '00:00';
                    document.getElementById('countdownFull').innerText = '00:00:00';
                    alert('R∆∞∆°ng ƒë√£ m·ªü!');
                    return;
                }
                lastUpdate = timestamp;
            }
            requestAnimationFrame(updateTimer);
        }
        requestAnimationFrame(updateTimer);
    </script>
</body>
</html>
