<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thời gian đếm ngược</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    .container { max-width: 600px; margin: auto; }
    .username { font-size: 24px; font-weight: bold; }
    .box-info { font-size: 18px; margin: 10px 0; }
    .timer { font-size: 32px; color: #e74c3c; }
  </style>
</head>
<body>
  <div class="container">
    <div class="username" id="username">@username</div>
    <div class="box-info" id="boxInfo">🎁 ?/? 🏳️ 👀 ?</div>
    <div class="timer" id="timer">00:00:00</div>
    <div id="boxTime">--:--:--</div>
    <div>Canh giờ hoàng đạo</div>
  </div>

  <script>
    function getQueryParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        user: params.get('user') || 'username',
        box: params.get('box') || '0',
        divide: params.get('divide') || '0',
        viewers: params.get('viewers') || '0',
        country: params.get('country') || '🏳️',
        end: parseInt(params.get('end')) || 0,
        createAt: params.get('createAt') || ''
      };
    }

    function formatRemainingTime(ms) {
      if (ms <= 0) return '00:00:00';
      const seconds = Math.floor(ms / 1000);
      const minutes = Math.floor(seconds / 60);
      const secs = seconds % 60;
      const hours = Math.floor(minutes / 60);
      const mins = minutes % 60;
      return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function formatBoxTime(createAt) {
      if (!createAt) return '--:--:--';
      const date = new Date(parseInt(createAt));
      return date.toLocaleTimeString('vi-VN', { hour12: false });
    }

    function updateDisplay() {
      const params = getQueryParams();
      document.getElementById('username').textContent = `@${params.user}`;
      document.getElementById('boxInfo').textContent = `🎁 ${params.box}/${params.divide} ${params.country} 👀 ${params.viewers}`;
      document.getElementById('boxTime').textContent = formatBoxTime(params.createAt);

      const updateTimer = () => {
        const now = Date.now();
        const remaining = params.end - now;
        document.getElementById('timer').textContent = formatRemainingTime(remaining);
        if (remaining <= 0) clearInterval(timerInterval);
      };

      updateTimer();
      const timerInterval = setInterval(updateTimer, 1000);
    }

    window.onload = updateDisplay;
  </script>
</body>
</html>
