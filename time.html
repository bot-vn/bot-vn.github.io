<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Box Countdown</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    .info {
      text-align: center;
      margin-bottom: 20px;
    }
    .info h2 {
      margin: 0;
      font-size: 28px;
      color: #0056b3; /* M√†u xanh d∆∞∆°ng ƒë·∫≠m */
    }
    .info p {
      margin: 4px 0;
      font-size: 18px;
      color: #666;
    }
    .timer {
      font-size: 80px;
      font-weight: bold;
      color: #000;
    }
    .timestamp {
      margin-top: 5px;
      font-size: 18px;
      color: #444;
    }
    .flag {
      font-size: 20px;
    }
  </style>
</head>
<body>
  <div class="info">
    <h2 id="username">@username</h2>
    <p id="boxinfo">üéÅ ?/? <span class="flag">üè≥Ô∏è</span> üëÄ ?</p>
  </div>

  <div class="timer" id="countdown">00:00</div>
  <div class="timestamp" id="dropTime">--:--:--</div>

  <script>
    function getParam(name) {
      return new URLSearchParams(window.location.search).get(name);
    }

    // Base62 decoding
    const base62chars = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
    function base62ToNumber(str) {
      return [...str].reduce((acc, c) => acc * 62 + base62chars.indexOf(c), 0);
    }

    function getFlag(countryCode) {
      if (!countryCode || countryCode.length !== 2) return "üè≥Ô∏è";
      const codePoints = [...countryCode.toUpperCase()].map(c => 0x1F1E6 + c.charCodeAt(0) - 65);
      return String.fromCodePoint(...codePoints);
    }

    const id = getParam("id");
    if (!id || id.length < 11) {
      const usernameElem = document.getElementById("username");
      usernameElem.innerText = "L·ªói d·ªØ li·ªáu";
      usernameElem.style.color = "#0056b3"; // M√†u xanh d∆∞∆°ng ƒë·∫≠m khi l·ªói
    } else {
      const raw = base62ToNumber(id);
      const duration = raw & 0xFF;
      const box = (raw >> 8) & 0xFF;
      const divide = (raw >> 16) & 0xFF;
      const viewers = (raw >> 24) & 0xFF;
      const countryCode = ((raw >> 32) & 0xFF);
      const usernameCode = (raw >> 40) & 0xFFFF;
      const startOffsetSec = (raw >> 56);
      const baseTimestamp = Date.UTC(2025, 5, 1, 0, 0, 0); // m·ªëc: 01/06/2025 UTC
      const start = baseTimestamp + startOffsetSec * 1000;

      const username = "u" + usernameCode.toString().padStart(4, '0');
      const country = String.fromCharCode(65 + (countryCode % 26)) + "A";

      document.getElementById("username").innerText = `@${username}`;
      document.getElementById("boxinfo").innerHTML = `üéÅ ${box}/${divide} <span class="flag">${getFlag(country)}</span> üëÄ ${viewers}`;

      const end = start + duration * 1000;
      const dropTime = new Date(start);
      document.getElementById("dropTime").innerText = `${dropTime.toLocaleTimeString('vi-VN')}`;

      function updateTimer() {
        const now = Date.now();
        const remaining = Math.max(0, Math.floor((end - now) / 1000));
        const m = Math.floor(remaining / 60);
        const s = remaining % 60;
        document.getElementById("countdown").innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        if (remaining > 0) setTimeout(updateTimer, 1000);
      }

      updateTimer();
    }
  </script>
</body>
</html>
