<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Config</title>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background-color: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
      width: 100vw;
      height: 100vh;
    }
    .container {
      background-color: #fff;
      padding: 16px;
      border: 1px solid #ccc;
      border-radius: 10px;
      width: 100%;
      max-width: 340px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      min-height: 420px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    h2 { color: #dc3545; margin-bottom: 12px; text-align: center; font-weight: bold; }
    .row { display: flex; align-items: center; gap: 6px; margin-bottom: 8px; }
    .input-group { margin-bottom: 10px; text-align: left; }
    .input-group label { display: block; margin-bottom: 2px; font-weight: bold; font-size: 13px; }
   input[type="text"], input[type="number"],
input[inputmode="numeric"], input[inputmode="decimal"] {
  width: 100%;
  padding: 4px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 13px;
  box-sizing: border-box;
  transition: border 0.2s ease-in-out;
}
input:focus {
  outline: none;
  border: 2px solid orange;
  box-shadow: 0 0 0 2px rgba(255,165,0,0.2);
}

textarea:focus {
  outline: none;
  border: 2px solid orange;
  box-shadow: 0 0 0 2px rgba(255,165,0,0.2);
}

    .button-group { display: flex; justify-content: space-between; margin-top: 10px; gap: 8px; align-items: center; }
    button { flex: 1; padding: 8px; font-size: 13px; border: none; border-radius: 5px; cursor: pointer; }
    button.restart { background-color: #6c757d; color: white; }
    button.save { background-color: #007BFF; color: white; }

.three-inputs {
  display: flex;
  justify-content: space-between;
  margin-bottom: 12px;
  font-size: 16px;
  gap: 10px;
}
.input-pair {
  display: flex;
  align-items: center;
  gap: 4px;
}
.input-pair label {
  white-space: nowrap;
font-size: 14px; 
}
.input-pair input {
  width: 60px;
  padding: 4px;
  box-sizing: border-box;
}
textarea.input-textarea {
  width: 100%;
  padding: 4px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 13px;
  box-sizing: border-box;
  resize: vertical;
  line-height: 1.4;
  transition: border 0.2s ease-in-out;
}
textarea.input-textarea:focus {
  outline: none;
  border: 2px solid orange;
  box-shadow: 0 0 0 2px rgba(255,165,0,0.2);
}
    .region-group { display: flex; justify-content: space-between; margin-top: 18px; margin-bottom: 8px; gap: 6px; }
    .region-group button {
      background-color: #f1f1f1; border: 1px solid #ccc; color: #000; cursor: pointer;
      padding: 2px 6px; border-radius: 4px; width: auto; transition: all 0.2s ease-in-out;
      font-size: 12px; line-height: 1.2; white-space: nowrap;
    }
    .region-group button.active { background-color: #007BFF; color: white; border-color: #007BFF; }
    .flag-group {
      display: flex; flex-wrap: wrap; gap: 4px; margin-top: 6px; max-height: 60px; overflow-y: auto;
      border: 1px solid #ccc; padding: 4px; background: #fff; border-radius: 4px; font-size: 18px;
      min-height: 32px; transition: border 0.2s ease-in-out;
    }
    .flag-group:focus { outline: none; border: 2px solid orange; box-shadow: 0 0 0 2px rgba(255,165,0,0.2); }
    .flag { cursor: pointer; }
    .flag.selected { color: #007BFF; font-weight: bold; }
    #customRegionIds { border-radius: 4px; }

  </style>
</head>
<body>
  <div id="loadingScreen">
    <div class="circle-wrapper">
      <div class="circle-loader">
        <div class="circle-progress" id="circleProgress"></div>
        <div id="loadingText">ƒêang t·∫£i 0%</div>
      </div>
    </div>
  </div>

  <div class="container" style="display: none;">
    <div style="text-align:center; margin-bottom: 12px;">
  <div style="font-size: 32px; line-height: 1;">üëë</div>
  <h2 style="margin: 0 0 16px;">BOT AUTO R∆Ø∆†NG</h2>
   <div id="advancedOptions" style="display:block; text-align:left;">
  <div class="input-group"> <!-- üü¢TH√îNG B√ÅO M√É R∆Ø∆†NG NH·ªé -->
    <label style="font-weight: bold; display: block; font-size: 14px;">üîç TH√îNG B√ÅO R∆Ø∆†NG NH·ªé: üü¢</label>
    <div class="three-inputs">
      <div class="input-pair">
        <label for="normalCoins">Xu:</label>
        <input inputmode="numeric" pattern="[0-9]*" id="normalCoins" style="font-size:16px;">
      </div>
      <div class="input-pair">
        <label for="normalRate">T·ª∑ l·ªá:</label>
        <input inputmode="decimal" pattern="[0-9.]*" id="normalRate" style="font-size:16px;">
      </div>
      <div class="input-pair">
        <label for="normalTime">Gi√¢y:</label>
        <input inputmode="numeric" pattern="[0-9]*" id="normalTime" style="font-size:16px;">
      </div>
    </div>
  </div> <!-- ‚úÖ ƒê√ìNG input-group r∆∞∆°ng nh·ªè -->

  <div class="input-group"> <!-- ‚≠ê‚≠ê‚≠êTH√îNG B√ÅO R∆Ø∆†NG L·ªöN -->
    <label style="font-weight: bold; display: block; font-size: 14px;">üîç TH√îNG B√ÅO R∆Ø∆†NG L·ªöN: ‚≠ê‚≠ê‚≠ê</label>
    <div class="three-inputs">
      <div class="input-pair">
        <label for="potentialCoins">Xu:</label>
        <input inputmode="numeric" pattern="[0-9]*" id="potentialCoins" style="font-size:16px;">
      </div>
  <div class="input-pair">
    <label for="potentialRate">T·ª∑ l·ªá:</label>
    <input inputmode="decimal" pattern="[0-9.]*" id="potentialRate" style="font-size:16px;">
  </div>
  <div class="input-pair">
    <label for="potentialTime">Gi√¢y:</label>
    <input inputmode="numeric" pattern="[0-9]*" id="potentialTime" style="font-size:16px;">
  </div>
</div>

    <div class="region-group">
      <button class="region-btn active" onclick="selectRegion('all')">T·∫•t c·∫£</button>
      <button class="region-btn" onclick="selectRegion('asia')">Ch√¢u √Å</button>
      <button class="region-btn" onclick="selectRegion('europe')">Ch√¢u √Çu</button>
      <button class="region-btn" onclick="selectRegion('custom')">T√πy ch·ªçn</button>
    </div>

    <div id="flagGroup" class="flag-group" contenteditable="false"></div>

    <div class="input-group" style="margin-top: 16px;">
      <label for="idolIds">üÜî T√ÄI KHO·∫¢N D√ôNG ƒê·ªÇ FOLLOW iDOL:</label>
   <textarea id="idolIds" placeholder="Ghi nick tiktok c√°ch nhau b·∫±ng d·∫•u ," rows="1" class="input-textarea"></textarea>
    </div>

    <div class="button-group">
      <button class="restart" onclick="resetToDefault()">V·ªÅ m·∫∑c ƒë·ªãnh</button>
      <button class="save" onclick="confirmPasswordAndSave()">L∆∞u</button>
    </div>
    <div id="message" style="margin-top:10px;font-size:13px;"></div>
  </div>

<script>
let currentRegion = "all";
let manualEdit = false;
let lastEditedFlags = {
  all: null,
  asia: null,
  europe: null,
  custom: null
};

function confirmPasswordAndSave() {
  const password = prompt("üîí Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ l∆∞u c·∫•u h√¨nh:");
  if (password === "3333") {
    saveConfig();
  } else if (password !== null) {
    const messageElement = document.getElementById("message");
    messageElement.textContent = "‚ùå Sai m·∫≠t kh·∫©u!";
    messageElement.style.color = "#d9534f";
  }
}

const flags = (() => {
  const asia = ["AE","AF","AM","AZ","BD","BH","BN","BT","CY","EG","GE","HK","ID","IL","IN","IQ","IR","JO","JP","KG","KH","KP","KR","KW","KZ","LA","LB","LK","MM","MN","MO","MV","MY","NP","OM","PH","PK","PS","QA","RU","SA","SG","SY","TH","TJ","TL","TM","TR","TW","UZ","YE","VN"];
  const all = [...new Set([
    ...asia,
    "AD","AG","AI","AL","AO","AR","AS","AT","AU","AW","AX","BA","BB","BE","BF","BG","BI","BJ","BL","BM","BO","BR","BS","BW","BY","BZ","CA","CD","CF","CG","CH","CI","CK","CL","CM","CN","CO","CR","CV","CW","CZ","DE","DJ","DK","DM","DO","DZ","EC","EE","ER","ES","ET","FI","FJ","FM","FO","FR","GA","GB","GD","GF","GG","GH","GI","GL","GM","GN","GP","GQ","GR","GT","GU","GW","GY","HN","HR","HT","HU","IE","IM","IS","IT","JE","JM","KE","KI","KM","KN","KY","LC","LI","LR","LS","LT","LU","LV","LY","MA","MC","MD","ME","MF","MG","MH","MK","ML","MS","MT","MU","MW","MX","MZ","NA","NC","NE","NF","NG","NI","NL","NO","NR","NU","NZ","PA","PE","PF","PG","PL","PM","PN","PR","PT","PW","PY","RE","RO","RS","RW","SB","SC","SD","SE","SH","SI","SK","SL","SM","SN","SO","SR","SS","ST","SV","SX","SZ","TC","TD","TG","TO","TT","TV","TZ","UA","UG","US","UY","VA","VC","VE","VG","VI","VU","WF","WS","YT","ZA","ZM","ZW"
  ])];
  const europe = all.filter(code => !asia.includes(code));
  return { all, asia, europe };
})();

function getFlagEmoji(code) {
  return code && /^[A-Z]{2}$/.test(code) ? String.fromCodePoint(...code.split('').map(c => 0x1F1E6 + c.charCodeAt(0) - 65)) : '';
}

function selectRegion(region) {
  const flagGroup = document.getElementById("flagGroup");
  const buttons = document.querySelectorAll(".region-btn");
  buttons.forEach(btn => btn.classList.remove("active"));
  document.querySelector(`.region-btn[onclick*="${region}"]`).classList.add("active");

  // Lu√¥n reset emoji t·ª´ flags khi ch·ªçn v√πng m·ªõi
  let emojis;
if (region === "custom") {
  emojis = lastEditedFlags.custom || "";
} else {
 const codes = flags[region] || flags.all;
  if (!lastEditedFlags[region]) {
    lastEditedFlags[region] = codes.map(getFlagEmoji).join(" ");
  }
  emojis = lastEditedFlags[region];
}

flagGroup.textContent = emojis;
  flagGroup.setAttribute("contenteditable", "true");
  currentRegion = region;
}

function parseFlagsToCountryCodes(flagString) {
  const codes = [];
  const chars = [...flagString]; // Quan tr·ªçng: spread ƒë·ªÉ x·ª≠ l√Ω t·ª´ng emoji

  for (let i = 0; i < chars.length; i++) {
    const c1 = chars[i].codePointAt(0);
    const c2 = chars[i + 1]?.codePointAt(0);

    if (!c1 || !c2) continue;

    // Ki·ªÉm tra n·∫øu c·∫£ 2 k√Ω t·ª± ƒë·ªÅu l√† Regional Indicator (emoji qu·ªëc k·ª≥)
    if (0x1F1E6 <= c1 && c1 <= 0x1F1FF && 0x1F1E6 <= c2 && c2 <= 0x1F1FF) {
      const iso1 = String.fromCharCode(c1 - 0x1F1E6 + 65);
      const iso2 = String.fromCharCode(c2 - 0x1F1E6 + 65);
      codes.push(iso1 + iso2);
      i++; // b·ªè qua k√Ω t·ª± th·ª© 2 ƒë√£ x·ª≠ l√Ω
    }
  }

  return codes;
}
function saveConfig() {
  const emojis = document.getElementById("flagGroup").textContent.trim();
  const countryCodes = parseFlagsToCountryCodes(emojis);

  const payload = {
    telegram: {
      targetCountries: countryCodes,
      idolIds: document.getElementById("idolIds").value.trim(),
     SmallBox: {
  minCoins: parseInt(document.getElementById("normalCoins").value),
  minRate: +(Number(document.getElementById("normalRate").value.replace(',', '.')).toFixed(1)),
  minTime: parseInt(document.getElementById("normalTime").value)
},
BigBox: {
  minCoins: parseInt(document.getElementById("potentialCoins").value),
  minRate: +(Number(document.getElementById("potentialRate").value.replace(',', '.')).toFixed(1)),
  minTime: parseInt(document.getElementById("potentialTime").value)
}
    }
  };

  fetch("https://juicy-transparent-chocolate.glitch.me/save-config", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(res => res.text())
  .then(msg => {
    const messageElement = document.getElementById("message");
    messageElement.textContent = msg;
    messageElement.style.color = msg.includes('‚úÖ') ? '#28a745' : '#d9534f';
  })
  .catch(err => {
    const messageElement = document.getElementById("message");
    messageElement.textContent = '‚ùå L·ªói g·ª≠i d·ªØ li·ªáu: ' + err.message;
    messageElement.style.color = '#d9534f';
  });
}

window.addEventListener("DOMContentLoaded", () => {
  fetch("https://juicy-transparent-chocolate.glitch.me/get-config")
    .then(res => res.json())
    .then(config => {
      const t = config?.telegram || {};
      document.getElementById("normalCoins").value = t.SmallBox?.minCoins ?? 49;
      document.getElementById("normalRate").value = (t.SmallBox?.minRate ?? 1.6).toFixed(1);
      document.getElementById("normalTime").value = t.SmallBox?.minTime ?? 80;

      document.getElementById("potentialCoins").value = t.BigBox?.minCoins ?? 500;
      document.getElementById("potentialRate").value = (t.BigBox?.minRate ?? 1.6).toFixed(1);
      document.getElementById("potentialTime").value = t.BigBox?.minTime ?? 120;

      document.getElementById("idolIds").value = t.idolIds ?? '';
fetchDone = true;

    if (t.targetCountries?.length) {
  const countries = t.targetCountries;

let regionName = "custom";

const inAsia = countries.every(code => flags.asia.includes(code));
const inEurope = countries.every(code => flags.europe.includes(code));
const inAll = countries.every(code => flags.all.includes(code));
const isExactAll = flags.all.length === countries.length &&
                   flags.all.every(code => countries.includes(code));

if (isExactAll) {
  regionName = "all";
} else if (inAsia) {
  regionName = "asia";
} else if (inEurope) {
  regionName = "europe";
}
  const emojis = countries.map(getFlagEmoji).join(' ');
  document.getElementById("flagGroup").textContent = emojis;
    lastEditedFlags[regionName] = emojis;
  currentRegion = regionName;

  
if (regionName === "custom") {
  lastEditedFlags.custom = emojis;
} else {
  lastEditedFlags.custom = flags.all.map(getFlagEmoji).join(" ");
}

const buttons = document.querySelectorAll(".region-btn");
buttons.forEach(btn => btn.classList.remove("active"));
document.querySelector(`.region-btn[onclick*="${regionName}"]`)?.classList.add("active");
}
});

["normalRate", "potentialRate"].forEach(id => {
  const input = document.getElementById(id);
  input.addEventListener("blur", () => {
    const raw = input.value.replace(',', '.');  
    const val = parseFloat(raw);
    if (!isNaN(val)) {
      input.value = val.toFixed(1);  
    }
  });
});

document.getElementById("flagGroup").addEventListener("input", () => {
  const region = currentRegion;
  const text = document.getElementById("flagGroup").textContent;
  lastEditedFlags[region] = text;
});

document.getElementById("flagGroup").addEventListener("blur", () => {
  const rawText = document.getElementById("flagGroup").textContent.trim();
  const cleanCodes = parseFlagsToCountryCodes(rawText);
  document.getElementById("flagGroup").textContent = cleanCodes.map(getFlagEmoji).join(" ");
  lastEditedFlags[currentRegion] = document.getElementById("flagGroup").textContent;
});
}); 
function fixRateFormat() {
  ["normalRate", "potentialRate"].forEach(id => {
    const input = document.getElementById(id);
    const raw = input.value.replace(',', '.');
    const val = parseFloat(raw);
    if (!isNaN(val)) {
      input.value = val.toFixed(1);
    }
  });
}

function resetToDefault() {
  document.getElementById("normalCoins").value = 50;
  document.getElementById("normalRate").value = 1.6;
  document.getElementById("normalTime").value = 80;
  document.getElementById("potentialCoins").value = 600;
  document.getElementById("potentialRate").value = 2.0;
  document.getElementById("potentialTime").value = 120;

  fixRateFormat();

  ["all", "asia", "europe"].forEach(region => {
    const emojis = flags[region].map(getFlagEmoji).join(" ");
    lastEditedFlags[region] = emojis;
  });
  lastEditedFlags.custom = flags.all.map(getFlagEmoji).join(" ");

  selectRegion("all");

  const messageElement = document.getElementById("message");
  messageElement.textContent = "üìå ƒê√£ ch·ªçn c·∫•u h√¨nh m·∫∑c ƒë·ªãnh!";
  messageElement.style.color = "#28a745";
}
</script>

<div id="footerContact">Telegram & Facebook: JimmyHoang68</div>

<style>
  #footerContact {
    text-align: center;
    color: white;
    font-size: 13px;
    padding: 10px 0;
    width: 100%;
    position: fixed;
    bottom: 0;
    left: 0;
    z-index: 9999;
  }
#loadingScreen {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background-color: black;
  color: white;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-size: 18px;
  z-index: 99999;
  text-align: center;
}
.circle-wrapper {
  position: relative;
  width: 200px;
  height: 200px;
}
.circle-loader {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: black;
  display: flex;
  justify-content: center;
  align-items: center;
}
.circle-progress {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: conic-gradient(#33ccff 0deg, transparent 0deg);
  mask-image: radial-gradient(circle 92px at center, transparent 88px, black 88px);
  -webkit-mask-image: radial-gradient(circle 92px at center, transparent 88px, black 88px);
  box-shadow: 0 0 20px rgba(51, 204, 255, 0.9);
  transition: background 0.3s ease;
}
#loadingText {
  position: relative;
  z-index: 2;
  font-size: 18px;
  color: white;
  font-weight: bold;
  text-shadow: 0 0 6px #00ccff;
}
</style>

<script>
let percent = 0;
const duration = 5000;
const intervalTime = duration / 100;
const progressText = document.getElementById("loadingText");
const progressCircle = document.getElementById("circleProgress");

let fetchDone = false; 

let lastTap = 0;
document.querySelector('.circle-wrapper').addEventListener('touchend', (e) => {
  const currentTime = new Date().getTime();
  const tapLength = currentTime - lastTap;
  if (tapLength < 300 && tapLength > 0) {
    
    clearInterval(loadingInterval);
    clearInterval(dotInterval);
    document.getElementById("loadingScreen").style.display = "none";
    document.querySelector(".container").style.display = "flex";
  }
  lastTap = currentTime;
});

const colorGradient = ['#00f5ff', '#00e0ff', '#00cfff', '#00bfff', '#009eff', '#007eff', '#005eff', '#003eff', '#001eff', '#000dff'];

const blendColor = (startHex, endHex, ratio) => {
  const hexToRgb = hex => hex.match(/\w\w/g).map(x => parseInt(x, 16));
  const rgbToHex = rgb => '#' + rgb.map(x => x.toString(16).padStart(2, '0')).join('');
  const [r1, g1, b1] = hexToRgb(startHex);
  const [r2, g2, b2] = hexToRgb(endHex);
  const r = Math.round(r1 + (r2 - r1) * ratio);
  const g = Math.round(g1 + (g2 - g1) * ratio);
  const b = Math.round(b1 + (b2 - b1) * ratio);
  return rgbToHex([r, g, b]);
};

const loadingInterval = setInterval(() => {
  percent++;
  const degree = Math.floor((percent / 100) * 360);
  const segments = 100;
  const segmentSize = degree / segments;
  let gradient = '';
  for (let i = 0; i < segments; i++) {
    const start = i * segmentSize;
    const end = (i + 1) * segmentSize;
    const t = i / segments;
    const colorIndex = t * (colorGradient.length - 1);
    const lower = Math.floor(colorIndex);
    const upper = Math.min(lower + 1, colorGradient.length - 1);
    const blend = colorIndex - lower;
    const segColor = blendColor(colorGradient[lower], colorGradient[upper], blend);
    gradient += `${segColor} ${start}deg ${end}deg${i < segments - 1 ? ', ' : ''}`;
  }
  gradient += `, transparent ${degree}deg`;
  progressCircle.style.background = `conic-gradient(${gradient})`;

  if (percent < 100) {
    progressText.textContent = `ƒêang t·∫£i ${percent}%`;
  } else {
    clearInterval(loadingInterval);
    if (fetchDone) {
      progressText.textContent = "‚úÖ Xong!";
      progressCircle.style.background = `conic-gradient(#00ff99 360deg, transparent 0deg)`;
      setTimeout(() => {
        document.getElementById("loadingScreen").style.display = "none";
        document.querySelector(".container").style.display = "flex";
      }, 300);
    } else {
      startDotsAnimation();
    }
  }
}, intervalTime);

// Nh√°y "S·∫Øp xong r·ªìi.", "..", "..." n·∫øu fetch ch∆∞a xong
let dotInterval = null;
function startDotsAnimation() {
  let dots = 0;
  dotInterval = setInterval(() => {
    dots = (dots + 1) % 4;
    let text = "S·∫Øp xong r·ªìi" + ".".repeat(dots);
    progressText.textContent = text;
    if (fetchDone) {
      clearInterval(dotInterval);
      progressText.textContent = "‚úÖ Xong!";
      progressCircle.style.background = `conic-gradient(#00ff99 360deg, transparent 0deg)`;
      setTimeout(() => {
        document.getElementById("loadingScreen").style.display = "none";
        document.querySelector(".container").style.display = "flex";
      }, 300);
    }
  }, 500);
}
</script>
</body>
</html>
