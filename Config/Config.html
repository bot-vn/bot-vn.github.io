<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Config</title>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background-color: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
      width: 100vw;
      height: 100vh;
    }
    .container {
      background-color: #fff;
      padding: 16px;
      border: 1px solid #ccc;
      border-radius: 10px;
      width: 100%;
      max-width: 340px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      min-height: 420px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    h2 { color: #dc3545; margin-bottom: 12px; text-align: center; font-weight: bold; }
    .row { display: flex; align-items: center; gap: 6px; margin-bottom: 8px; }
    .input-group { margin-bottom: 10px; text-align: left; }
    .input-group label { display: block; margin-bottom: 2px; font-weight: bold; font-size: 13px; }
   input[type="text"], input[type="number"],
input[inputmode="numeric"], input[inputmode="decimal"] {
  width: 100%;
  padding: 4px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 13px;
  box-sizing: border-box;
  transition: border 0.2s ease-in-out;
}
input:focus {
  outline: none;
  border: 2px solid orange;
  box-shadow: 0 0 0 2px rgba(255,165,0,0.2);
}

textarea:focus {
  outline: none;
  border: 2px solid orange;
  box-shadow: 0 0 0 2px rgba(255,165,0,0.2);
}

    .button-group { display: flex; justify-content: space-between; margin-top: 10px; gap: 8px; align-items: center; }
    button { flex: 1; padding: 8px; font-size: 13px; border: none; border-radius: 5px; cursor: pointer; }
    button.restart { background-color: #6c757d; color: white; }
    button.save { background-color: #007BFF; color: white; }

.three-inputs {
  display: flex;
  justify-content: space-between;
  margin-bottom: 12px;
  font-size: 16px;
  gap: 10px;
}
.input-pair {
  display: flex;
  align-items: center;
  gap: 4px;
}
.input-pair label {
  white-space: nowrap;
font-size: 14px; 
}
.input-pair input {
  width: 60px;
  padding: 4px;
  box-sizing: border-box;
}
textarea.input-textarea {
  width: 100%;
  padding: 4px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 13px;
  box-sizing: border-box;
  resize: vertical;
  line-height: 1.4;
  transition: border 0.2s ease-in-out;
}
textarea.input-textarea:focus {
  outline: none;
  border: 2px solid orange;
  box-shadow: 0 0 0 2px rgba(255,165,0,0.2);
}
    .region-group { display: flex; justify-content: space-between; margin-top: 18px; margin-bottom: 8px; gap: 6px; }
    .region-group button {
      background-color: #f1f1f1; border: 1px solid #ccc; color: #000; cursor: pointer;
      padding: 2px 6px; border-radius: 4px; width: auto; transition: all 0.2s ease-in-out;
      font-size: 12px; line-height: 1.2; white-space: nowrap;
    }
    .region-group button.active { background-color: #007BFF; color: white; border-color: #007BFF; }
    .flag-group {
      display: flex; flex-wrap: wrap; gap: 4px; margin-top: 6px; max-height: 60px; overflow-y: auto;
      border: 1px solid #ccc; padding: 4px; background: #fff; border-radius: 4px; font-size: 18px;
      min-height: 32px; transition: border 0.2s ease-in-out;
    }
    .flag-group:focus { outline: none; border: 2px solid orange; box-shadow: 0 0 0 2px rgba(255,165,0,0.2); }
    .flag { cursor: pointer; }
    .flag.selected { color: #007BFF; font-weight: bold; }
    #customRegionIds { border-radius: 4px; }

  </style>
</head>
<body>
  <div class="container">
    <div style="text-align:center; margin-bottom: 12px;">
  <div style="font-size: 32px; line-height: 1;">üëë</div>
  <h2 style="margin: 0 0 16px;">BOT AUTO R∆Ø∆†NG</h2>
     <div id="advancedOptions" style="display:block; text-align:left;">
      <div class="input-group">
        <label style="font-weight: bold; display: block; font-size: 14px;">M√É R∆Ø∆†NG NH·ªé: üü¢</label>
      <div class="three-inputs">
  <div class="input-pair">
    <label for="normalCoins">Xu:</label>
    <input inputmode="numeric" pattern="[0-9]*" id="normalCoins" style="font-size:16px;">
  </div>
  <div class="input-pair">
    <label for="normalRate">T·ª∑ l·ªá:</label>
     <input inputmode="decimal" pattern="[0-9.]*" id="normalRate" style="font-size:16px;">
  </div>
  <div class="input-pair">
    <label for="normalTime">Gi√¢y:</label>
     <input inputmode="numeric" pattern="[0-9]*" id="normalTime" style="font-size:16px;">
  </div>
</div>

      <div class="input-group">
        <label style="font-weight: bold; display: block; font-size: 14px;">M√É R∆Ø∆†NG L·ªöN: ‚≠ê‚≠ê‚≠ê</label>
<div class="three-inputs">
  <div class="input-pair">
    <label for="potentialCoins">Xu:</label>
    <input inputmode="numeric" pattern="[0-9]*" id="potentialCoins" style="font-size:16px;">
  </div>
  <div class="input-pair">
    <label for="potentialRate">T·ª∑ l·ªá:</label>
    <input inputmode="decimal" pattern="[0-9.]*" id="potentialRate" style="font-size:16px;">
  </div>
  <div class="input-pair">
    <label for="potentialTime">Gi√¢y:</label>
    <input inputmode="numeric" pattern="[0-9]*" id="potentialTime" style="font-size:16px;">
  </div>
</div>

    <div class="region-group">
      <button class="region-btn active" onclick="selectRegion('all')">T·∫•t c·∫£</button>
      <button class="region-btn" onclick="selectRegion('asia')">Ch√¢u √Å</button>
      <button class="region-btn" onclick="selectRegion('europe')">Ch√¢u √Çu</button>
      <button class="region-btn" onclick="selectRegion('custom')">T√πy ch·ªçn</button>
    </div>

    <div id="flagGroup" class="flag-group" contenteditable="false"></div>

    <div class="input-group" style="margin-top: 16px;">
      <label for="idolIds">T√ÄI KHO·∫¢N FOLLOW iDOL:</label>
   <textarea id="idolIds" placeholder="Ghi nick tiktok c√°ch nhau b·∫±ng d·∫•u ," rows="1" class="input-textarea"></textarea>
    </div>

    <div class="button-group">
      <button class="restart" onclick="resetToDefault()">V·ªÅ m·∫∑c ƒë·ªãnh</button>
      <button class="save" onclick="confirmPasswordAndSave()">L∆∞u</button>
    </div>
    <div id="message" style="margin-top:10px;font-size:13px;"></div>
  </div>

<script>
let currentRegion = "all";
let manualEdit = false;
let lastEditedFlags = {
  all: null,
  asia: null,
  europe: null,
  custom: null
};
function confirmPasswordAndSave() {
  const password = prompt("üîí Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ l∆∞u c·∫•u h√¨nh:");
  if (password === "3333") {
    saveConfig();
  } else if (password !== null) {
    const messageElement = document.getElementById("message");
    messageElement.textContent = "‚ùå Sai m·∫≠t kh·∫©u!";
    messageElement.style.color = "#d9534f";
  }
}

  const flags = (() => {
    const asia = ["AE","AF","AM","AZ","BD","BH","BN","BT","CY","EG","GE","HK","ID","IL","IN","IQ","IR","JO","JP","KG","KH","KP","KR","KW","KZ","LA","LB","LK","MM","MN","MO","MV","MY","NP","OM","PH","PK","PS","QA","RU","SA","SG","SY","TH","TJ","TL","TM","TR","TW","UZ","YE","VN"];
    const all = [...new Set([
      ...asia,
      "AD","AG","AI","AL","AO","AR","AS","AT","AU","AW","AX","BA","BB","BE","BF","BG","BI","BJ","BL","BM","BO","BR","BS","BW","BY","BZ","CA","CD","CF","CG","CH","CI","CK","CL","CM","CN","CO","CR","CV","CW","CZ","DE","DJ","DK","DM","DO","DZ","EC","EE","ER","ES","ET","FI","FJ","FM","FO","FR","GA","GB","GD","GF","GG","GH","GI","GL","GM","GN","GP","GQ","GR","GT","GU","GW","GY","HN","HR","HT","HU","IE","IM","IS","IT","JE","JM","KE","KI","KM","KN","KY","LC","LI","LR","LS","LT","LU","LV","LY","MA","MC","MD","ME","MF","MG","MH","MK","ML","MS","MT","MU","MW","MX","MZ","NA","NC","NE","NF","NG","NI","NL","NO","NR","NU","NZ","PA","PE","PF","PG","PL","PM","PN","PR","PT","PW","PY","RE","RO","RS","RW","SB","SC","SD","SE","SH","SI","SK","SL","SM","SN","SO","SR","SS","ST","SV","SX","SZ","TC","TD","TG","TO","TT","TV","TZ","UA","UG","US","UY","VA","VC","VE","VG","VI","VU","WF","WS","YT","ZA","ZM","ZW"
    ])];
    const europe = all.filter(code => !asia.includes(code));
    return { all, asia, europe };
  })();

  function getFlagEmoji(code) {
    return code && /^[A-Z]{2}$/.test(code) ? String.fromCodePoint(...code.split('').map(c => 0x1F1E6 + c.charCodeAt(0) - 65)) : '';
  }

 function selectRegion(region) {
  const flagGroup = document.getElementById("flagGroup");
  const buttons = document.querySelectorAll(".region-btn");
  buttons.forEach(btn => btn.classList.remove("active"));
  document.querySelector(`.region-btn[onclick*="${region}"]`).classList.add("active");

  // N·∫øu ƒë√£ t·ª´ng ch·ªânh s·ª≠a v√πng n√†y th√¨ hi·ªÉn th·ªã l·∫°i emoji ƒë√£ s·ª≠a
  if (lastEditedFlags[region] !== null) {
  flagGroup.textContent = lastEditedFlags[region];
} else {
  const codes = flags[region] || flags.all;
  flagGroup.textContent = codes.map(getFlagEmoji).join(' ');
}

  flagGroup.setAttribute("contenteditable", "true");
  currentRegion = region;
}

  function parseFlagsToCountryCodes(flagString) {
    const codes = [];
    for (let i = 0; i < flagString.length; i += 2) {
      const part = flagString.codePointAt(i);
      const next = flagString.codePointAt(i + 1);
      if (!next) continue;
      const c1 = String.fromCharCode(part - 0x1F1E6 + 65);
      const c2 = String.fromCharCode(next - 0x1F1E6 + 65);
      if (/^[A-Z]{2}$/.test(c1 + c2)) codes.push(c1 + c2);
    }
    return codes;
  }

  function saveConfig() {
    const region = document.querySelector(".region-btn.active")?.textContent?.trim().toLowerCase();
    let countryCodes = [];

    if (region === "t√πy ch·ªçn" || region === "custom") {
      const emojis = document.getElementById("flagGroup").textContent.trim();
      countryCodes = parseFlagsToCountryCodes(emojis);
    } else {
      countryCodes = flags[region === "ch√¢u √°" ? "asia" : region === "ch√¢u √¢u" ? "europe" : "all"];
    }

    const payload = {
      telegram: {
        targetCountries: countryCodes,
        idolIds: document.getElementById("idolIds").value.trim(),
        SmallBox: {
          minCoins: parseInt(document.getElementById("normalCoins").value),
          minRate: parseFloat(parseFloat(document.getElementById("normalRate").value.replace(',', '.')).toFixed(1)),
          minTime: parseInt(document.getElementById("normalTime").value)
        },
        BigBox: {
          minCoins: parseInt(document.getElementById("potentialCoins").value),
          minRate: parseFloat(parseFloat(document.getElementById("potentialRate").value.replace(',', '.')).toFixed(1)),
          minTime: parseInt(document.getElementById("potentialTime").value)
        }
      }
    };

    fetch("https://juicy-transparent-chocolate.glitch.me/save-config", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    })
    .then(res => res.text())
    .then(msg => {
      const messageElement = document.getElementById("message");
      messageElement.textContent = msg;
      messageElement.style.color = msg.includes('‚úÖ') ? '#28a745' : '#d9534f';
    })
    .catch(err => {
      const messageElement = document.getElementById("message");
      messageElement.textContent = '‚ùå L·ªói g·ª≠i d·ªØ li·ªáu: ' + err.message;
      messageElement.style.color = '#d9534f';
    });
  }

  // Khi load trang:
  window.addEventListener("DOMContentLoaded", () => {
    selectRegion("all");
    fetch("https://juicy-transparent-chocolate.glitch.me/get-config")
      .then(res => res.json())
      .then(config => {
        const t = config?.telegram || {};
        document.getElementById("normalCoins").value = t.SmallBox?.minCoins ?? 49;
        document.getElementById("normalRate").value = (t.SmallBox?.minRate ?? 1.6).toFixed(1);
        document.getElementById("normalTime").value = t.SmallBox?.minTime ?? 80;

        document.getElementById("potentialCoins").value = t.BigBox?.minCoins ?? 500;
        document.getElementById("potentialRate").value = (t.BigBox?.minRate ?? 1.6).toFixed(1);
        document.getElementById("potentialTime").value = t.BigBox?.minTime ?? 120;

        document.getElementById("idolIds").value = t.idolIds ?? '';

if (t.targetCountries?.length) {
  const countries = t.targetCountries;
  const regionName = Object.keys(flags).find(key => {
    const setA = new Set(flags[key]);
    const setB = new Set(countries);
    return setA.size === setB.size && [...setA].every(x => setB.has(x));
  }) || "custom";

  const emojis = countries.map(getFlagEmoji).join(' ');
  document.getElementById("flagGroup").textContent = emojis;
  lastEditedFlags[regionName] = emojis;
  currentRegion = regionName;

  const buttons = document.querySelectorAll(".region-btn");
  buttons.forEach(btn => btn.classList.remove("active"));
  document.querySelector(`.region-btn[onclick*="${regionName}"]`)?.classList.add("active");
}  
 
  });
["normalRate", "potentialRate"].forEach(id => {
  const input = document.getElementById(id);
  input.addEventListener("blur", () => {
    const val = parseFloat(input.value);
    if (!isNaN(val)) input.value = val.toFixed(1);
  });
});
// ‚úÖ G·∫Øn sau c√πng ‚Äî ngo√†i forEach
document.getElementById("flagGroup").addEventListener("input", () => {
  const region = currentRegion;
  const text = document.getElementById("flagGroup").textContent;
  lastEditedFlags[region] = text;
});
  });
function fixRateFormat() {
  ["normalRate", "potentialRate"].forEach(id => {
    const input = document.getElementById(id);
    const val = parseFloat(input.value);
    if (!isNaN(val)) input.value = val.toFixed(1);
  });
}

function resetToDefault() {
  // Reset s·ªë li·ªáu
  document.getElementById("normalCoins").value = 50;
  document.getElementById("normalRate").value = 1.6;
  document.getElementById("normalTime").value = 80;

  document.getElementById("potentialCoins").value = 600;
  document.getElementById("potentialRate").value = 2.0;
  document.getElementById("potentialTime").value = 120;

  fixRateFormat();

  // Reset emoji m·∫∑c ƒë·ªãnh cho all, asia, europe
  ["all", "asia", "europe"].forEach(region => {
    const emojis = flags[region].map(getFlagEmoji).join(" ");
    lastEditedFlags[region] = emojis;
  });
  lastEditedFlags.custom = flags.all.map(getFlagEmoji).join(" ");

  // Tr·ªü l·∫°i v√πng all m·∫∑c ƒë·ªãnh
  selectRegion("all");

  // Hi·ªÉn th·ªã th√¥ng b√°o
  const messageElement = document.getElementById("message");
  messageElement.textContent = "‚úÖ ƒê√£ ch·ªçn c·∫•u h√¨nh m·∫∑c ƒë·ªãnh!";
  messageElement.style.color = "#28a745";
}</script>
</body>
</html>
